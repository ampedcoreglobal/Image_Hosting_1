<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Image Uploader</title>
  <style>
    body { font-family: Arial; background: #111; color: #eee; }
    #dropzone {
      border: 2px dashed #4caf50; padding: 30px; margin: 20px;
      text-align: center; cursor: pointer; background: #222;
    }
    #log { background: #000; color: #0f0; padding: 10px; height: 300px; overflow-y: auto; white-space: pre-wrap; }
    button { margin-top: 10px; padding: 10px 20px; background: #4caf50; border: none; color: white; cursor: pointer; }
    button:disabled { background: #666; }
  </style>
</head>
<body>
  <h2>Drag & Drop Images Folder</h2>
  <div id="dropzone">Drop files here or click to select</div>
  <input type="file" id="fileInput" webkitdirectory directory multiple style="display:none">
  <button id="uploadBtn">Upload & Process</button>
  <h3>Log:</h3>
  <div id="log"></div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const log = document.getElementById('log');
    let files = [];

    function logMessage(msg) {
      log.textContent += msg + "\n";
      log.scrollTop = log.scrollHeight;
    }

    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.style.background = '#333'; });
    dropzone.addEventListener('dragleave', () => dropzone.style.background = '#222');
    dropzone.addEventListener('drop', e => {
      e.preventDefault(); files = [...e.dataTransfer.files];
      logMessage(`ðŸ“‚ ${files.length} files ready`);
    });
    fileInput.addEventListener('change', () => {
      files = [...fileInput.files];
      logMessage(`ðŸ“‚ ${files.length} files selected`);
    });

    uploadBtn.addEventListener('click', async () => {
      if (!files.length) return alert("No files selected.");
      uploadBtn.disabled = true; logMessage("â¬†ï¸ Uploading files...");

      const formData = new FormData();
      files.forEach(f => formData.append('files', f));
      await fetch('/upload', { method: 'POST', body: formData });
      logMessage("âœ… Files uploaded. Starting processing...");

      const res = await fetch('/process', { method: 'POST' });
      const reader = res.body.getReader();
      const decoder = new TextDecoder();
      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        logMessage(decoder.decode(value));
      }
      uploadBtn.disabled = false;
    });
  </script>
</body>
</html>
