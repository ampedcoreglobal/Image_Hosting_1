<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upload Image Folder</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #drop-zone { border: 2px dashed #666; padding: 40px; text-align: center; cursor: pointer; }
    #log { background: #111; color: #0f0; padding: 10px; font-family: monospace; height: 300px; overflow-y: auto; margin-top: 10px; }
    #progress-bar { height: 20px; background: green; width: 0%; transition: width 0.3s; }
    #progress-container { background: #ccc; width: 100%; height: 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Upload Image Folder</h2>
  <div id="drop-zone">Drag & Drop a Folder Here or Click to Select</div>
  <input type="file" id="fileInput" webkitdirectory multiple hidden>
  <button id="uploadBtn">Upload</button>
  <div id="progress-container"><div id="progress-bar"></div></div>
  <div id="status">Waiting...</div>
  <pre id="log"></pre>

<script>
const repoOwner = "ampedcoreglobal";
const repoName = "Image_Hosting_1";
const branch = "main";
const token = "YOUR_GITHUB_TOKEN_HERE"; // Replace with your PAT

let files = [];

const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const log = document.getElementById("log");
const status = document.getElementById("status");
const progressBar = document.getElementById("progress-bar");

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.background="#eee"; });
dropZone.addEventListener('dragleave', () => dropZone.style.background="");
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  files = Array.from(e.dataTransfer.files);
  logMessage(`ðŸ“‚ Selected ${files.length} files`);
  dropZone.style.background="";
});
fileInput.addEventListener('change', e => {
  files = Array.from(e.target.files);
  logMessage(`ðŸ“‚ Selected ${files.length} files`);
});

uploadBtn.addEventListener('click', async () => {
  if (!files.length) return alert("No folder selected");
  uploadBtn.disabled = true;
  status.innerText = "Uploading...";
  log.innerText = "";
  progressBar.style.width = "0%";

  let count = 0;
  for (let file of files) {
    if (file.name.startsWith('.') || file.name === '.DS_Store') continue;
    const arrayBuffer = await file.arrayBuffer();
    const content = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
    const path = `source_images/${file.webkitRelativePath}`;

    await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: `Upload ${file.name}`,
        content: content,
        branch: branch
      })
    });

    count++;
    progressBar.style.width = `${(count/files.length)*100}%`;
    logMessage(`[UPLOAD] ${file.webkitRelativePath}`);
  }

  status.innerText = "âœ… Files uploaded. Triggering processing...";

  await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/actions/workflows/process_images.yml/dispatches`, {
    method: "POST",
    headers: {
      "Authorization": `token ${token}`,
      "Accept": "application/vnd.github.v3+json"
    },
    body: JSON.stringify({ ref: branch })
  });

  logMessage("ðŸš€ Processing started on GitHub Actions.");
  uploadBtn.disabled = false;
});

function logMessage(msg){
  log.textContent += msg + "\n";
  log.scrollTop = log.scrollHeight;
}
</script>
</body>
</html>
